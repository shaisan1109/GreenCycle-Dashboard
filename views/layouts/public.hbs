<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://kit.fontawesome.com/2fcb76e57d.js" crossorigin="anonymous"></script>
</head>
<body>

    <header class="header">
        <img src="/pictures/Greencycle-Logo.png" class="header-logo">
            <div class="header-logo-text">
                GreenCycle
            </div>

            {{#if user.email}}
            <!-- If user is logged in, show user menu -->
                <div class="user-menu">
                    <!-- User Menu Button -->
                    <button class="user-menu-button">
                        <i class="fa-regular fa-circle-user header-user-icon"></i> {{uppercase user.lastname}}, {{user.firstname}}
                        <span class="user-menu-caret"><i class="fa-solid fa-caret-down"></i></span>
                    </button>

                    <div class="user-menu-content">
                        <a href="/dashboard/profile">
                            <i class="fa-solid fa-user"></i> Profile
                        </a>
                        <a href="#">
                            <i class="fa-solid fa-gear"></i> Settings
                        </a>
                        <a href="/">
                            <i class="fa-solid fa-house"></i> Return to Main Site
                        </a>
                        <a href="#" id="logout">
                            <i class="fa-solid fa-right-from-bracket"></i> Log Out
                        </a>
                    </div>
                </div>
            {{else}}
                <!-- Else, show login and register links for unlogged user -->
                <div class="login-menu">
                    <a href="/login">Login</a> | <a href="/register">Register</a> | <a href="/apply">Apply</a>
                </div>
            {{/if}}
    </header>
    
    <div class="taskbar">
        <ul>
            <a href="/" class="{{#if current_home}}current{{/if}}">HOME</a>
            <a href="/apply" class="{{#if current_apply}}current{{/if}}">APPLY</a>
            <a href="/dashboard">DASHBOARD</a>
            <a href="/about" class="{{#if current_about}}current{{/if}}">ABOUT</a>
            <a href="/partners" class="{{#if current_partners}}current{{/if}}">PARTNERS</a>
            <a href="/contact" class="{{#if current_contact}}current{{/if}}">CONTACT</a>
        </ul>
    </div>

    <main>
        {{{ body }}}
    </main>

    <footer class="footer">
        <div class="footer-section">
            <h3>Location:</h3>
            <p>3 Fulgencio Road, Grand Asia Compound,<br>Bgy Nagkaisang Nayon, Sitio Gitna,<br>1125 Quezon City, Philippines</p>
        </div>
        <div class="footer-section">
            <h3>Contact Us:</h3>
            <div class="social-buttons">
                <a href="https://facebook.com" target="_blank">
                    <img src="/pictures/facebook.png" class="icon">
                </a>
                <a href="https://accounts.google.com.ph/" target="_blank">
                    <img src="/pictures/gmail.png" class="icon">
                </a>
                <a href="https://linkedin.com" target="_blank">
                    <img src="/pictures/linkedin.png" class="icon">
                </a>
            </div>
            <p><i class="fas fa-envelope"></i> <i class="fas fa-phone"></i> 0906 880 6858</p>
        </div>
        <div class="footer-section">
            <h3>Other:</h3> 
            <button onclick="location.href='/about'">About Us</button>
            <button onclick="location.href='/partners'">Our Partners</button>
            <button onclick="location.href='/apply'">Apply for Access</button>
        </div>
    </footer>

    <script>
        // Handle logout button click
        const logoutButton = document.getElementById('logout');
        if (logoutButton) {
            logoutButton.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default navigation
                
                fetch('/logout', { 
                    method: 'DELETE', 
                    credentials: 'include' 
                })
                .then(response => {
                    if (response.ok) {
                        window.location.href = "/"; // Redirect to home after logout
                    }
                })
                .catch(err => console.error("Logout failed", err));
            });
        }
    </script>

</body>
</html>