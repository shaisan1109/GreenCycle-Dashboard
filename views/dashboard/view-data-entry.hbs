
<!-- Actual Data Display -->

<!-- Title card -->
<fieldset style="width: 97.3%; margin-bottom: 10px; padding-top: 20px; padding-bottom: 20px">
    <h1 style="margin:0">Insert Title Here</h1>
    <h3 style="margin:0; font-weight:normal;">
        <i class="fa-solid fa-location-dot"></i>&nbsp; {{wasteGen.location_name}}
    </h3>
</fieldset>

<!-- Data entry info -->
<div style="display: flex;">
    <fieldset style="width: 100%;">
        <legend>Submission Info</legend>
        <table class="user-profile">
            <tr>
                <td class="label">Submitted by</td>
                <td>{{uppercase wasteGen.lastname}}, {{wasteGen.firstname}}</td>
            </tr>
            <tr>
                <td class="label">Organization Name</td>
                <td>{{wasteGen.company_name}}</td>
            </tr>
            <tr>
                <td class="label">Date Submitted</td>
                <td>{{textDate wasteGen.date_submitted}}</td>
            </tr>
        </table>
    </fieldset>

    <fieldset style="width: 100%;">
        <legend>Collection Info</legend>
        <table class="user-profile">
            <tr>
                <td class="label">Start Date</td>
                <td>{{textDate wasteGen.collection_start}}</td>
            </tr>
            <tr>
                <td class="label">End Date</td>
                <td>{{textDate wasteGen.collection_end}}</td>
            </tr>
        </table>
    </fieldset>

    <fieldset style="width: 95%;">
            <legend>Waste Generation</legend>
            <table class="user-profile">
                <tr>
                    <td class="label">Population (based on Census)</td>
                    <td>{{commaNumber wasteGen.population}}</td>
                </tr>
                <tr>
                    <td class="label">Waste Generation per Capita (Kg/cap-day)</td>
                    <td>{{commaNumber wasteGen.per_capita}}</td>
                </tr>
                <tr>
                    <td class="label">Annual Waste Generation (kg/year)</td>
                    <td>{{commaNumber wasteGen.annual}}</td>
                </tr>
            </table>
        </fieldset>
</div>

<!-- Data tabs -->
<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Chart')" id="defaultOpen">CHART</button>
  <button class="tablinks" onclick="openTab(event, 'Table')">RAW DATA</button>
</div>

<!-- Display A: Chart -->
<div id="Chart" class="tabcontent">
    <!-- Supertype summary pie chart -->
    <div class="pie-chart">
        <canvas id="summary-pie">
            <!-- Populated by JS -->
        </canvas>
    </div>

    <!-- Subtypes bar charts -->
</div>

<!-- Display B: Raw Data -->
<div id="Table" class="tabcontent">
    <div style="display: flex;">
        <div>
            <!-- Waste Composition -->
            <table>
                <thead>
                    <tr>
                    <th>Waste Type</th>
                    {{#each sectors}}
                        <th style="width: 100px;">{{name}}</th>
                    {{/each}}
                    </tr>
                </thead>
                <tbody>
                    {{#each supertypes}}
                        <tr>
                            <td colspan="7"><strong>{{name}}</strong></td>
                        </tr>
                        {{#each types}}
                            <tr>
                            <td>{{name}}</td>
                            {{#with amounts as |a|}} <!-- Set alias for amounts -->
                                {{#each ../../../sectors}}
                                <td style="text-align: center;">{{lookup a this.id}}</td>
                                {{/each}}
                            {{/with}}
                            </tr>
                        {{/each}}
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Pie chart script -->
<script>

const pieData = {{{ pieData }}}; // safe JSON (triple mustaches for raw output)

const ctx = document.getElementById('summary-pie').getContext('2d');
const chart = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: pieData.labels,
        datasets: [{
            label: 'Total Waste (kg)',
            data: pieData.data,
            backgroundColor: ['#4caf50', '#2196f3', '#ff9800', '#f44336'], // Customize as needed
            hoverOffset: 30
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const value = context.parsed;
                        const total = context.chart._metasets[0].total || 
                                    context.chart._metasets[0].data.reduce((a, b) => a + b, 0);

                        const percentage = ((value / total) * 100).toFixed(1);
                        return ` ${value} kg (${percentage}%)`;
                    }
                }
            }
        }
    }
});

</script>

<!-- Access to chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- JS behind the tabs -->
<script src="/js/tabs.js"></script>
